<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>注册 - 乒乓球培训管理系统</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
  <div class="container mt-4">
    <h3>注册</h3>
    <ul class="nav nav-tabs" id="regTabs" role="tablist">
      <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#student">学员注册</a></li>
      <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#coach">教练注册</a></li>
    </ul>
    <div class="tab-content border-left border-right border-bottom p-3">
      <div class="tab-pane fade show active" id="student">
        <form id="studentForm">
          <div class="form-row">
            <div class="form-group col-md-6"><label>用户名</label><input class="form-control" id="s_username" required></div>
            <div class="form-group col-md-6"><label>密码</label><input type="password" class="form-control" id="s_password" required placeholder="请输入密码"></div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6"><label>姓名</label><input class="form-control" id="s_realname" required></div>
            <div class="form-group col-md-3"><label>性别</label><select class="form-control" id="s_gender"><option>男</option><option>女</option></select></div>
            <div class="form-group col-md-3"><label>年龄</label><input type="number" class="form-control" id="s_age"></div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6"><label>校区</label><select class="form-control" id="s_campus" required></select></div>
            <div class="form-group col-md-6"><label>电话</label><input class="form-control" id="s_phone" required></div>
          </div>
          <div class="form-group"><label>邮箱</label><input class="form-control" id="s_email"></div>
          <button class="btn btn-primary">提交</button>
        </form>
      </div>
      <div class="tab-pane fade" id="coach">
        <form id="coachForm">
          <div class="form-row">
            <div class="form-group col-md-6"><label>用户名</label><input class="form-control" id="c_username" required></div>
            <div class="form-group col-md-6"><label>密码</label><input type="password" class="form-control" id="c_password" required placeholder="请输入密码"></div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6"><label>姓名</label><input class="form-control" id="c_realname" required></div>
            <div class="form-group col-md-3"><label>性别</label><select class="form-control" id="c_gender"><option>男</option><option>女</option></select></div>
            <div class="form-group col-md-3"><label>年龄</label><input type="number" class="form-control" id="c_age"></div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6"><label>校区</label><select class="form-control" id="c_campus" required></select></div>
            <div class="form-group col-md-6"><label>电话</label><input class="form-control" id="c_phone" required></div>
          </div>
          <div class="form-group"><label>邮箱</label><input class="form-control" id="c_email"></div>
          <div class="form-group"><label>级别</label><select class="form-control" id="c_level"><option value="junior">初级</option><option value="middle">中级</option><option value="senior">高级</option></select></div>
          <div class="form-group"><label>获奖/成绩</label><textarea class="form-control" id="c_awards" rows="3"></textarea></div>
          <small class="text-muted">提交后等待校区管理员审核</small>
          <button class="btn btn-primary d-block mt-2">提交</button>
        </form>
      </div>
    </div>
    <div class="mt-3"><a href="/">返回登录</a></div>
  </div>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    async function loadCampuses() {
      const res = await fetch('/api/campuses');
      const data = await res.json();
      const s = document.getElementById('s_campus');
      const c = document.getElementById('c_campus');
      s.innerHTML = c.innerHTML = data.map(x=>`<option value="${x.id}">${x.name}</option>`).join('');
    }
    loadCampuses();
    function strong(p){return p && p.length>=8 && p.length<=16 && /[A-Za-z]/.test(p) && /\d/.test(p) && /[^A-Za-z0-9]/.test(p);}
    document.getElementById('studentForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const payload = {
        username: s_username.value.trim(), password: s_password.value.trim(), real_name: s_realname.value.trim(),
        gender: s_gender.value, age: s_age.value? parseInt(s_age.value): null, campus_id: parseInt(s_campus.value),
        phone: s_phone.value.trim(), email: s_email.value.trim()||null
      };
      const res = await fetch('/api/register/student',{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
      const d = await res.json(); if(!res.ok || !d.success){ alert(d.error||'注册失败'); return; }
      alert('学员注册成功，请返回登录');
    });
    document.getElementById('coachForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const payload = {
        username: c_username.value.trim(), password: c_password.value.trim(), real_name: c_realname.value.trim(),
        gender: c_gender.value, age: c_age.value? parseInt(c_age.value): null, campus_id: parseInt(c_campus.value),
        phone: c_phone.value.trim(), email: c_email.value.trim()||null, coach_level: c_level.value, coach_awards: c_awards.value.trim()
      };
      const res = await fetch('/api/register/coach',{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
      const d = await res.json(); if(!res.ok || !d.success){ alert(d.error||'注册失败'); return; }
      alert('教练注册成功，待校区管理员审核');
    });
  </script>
</body>
</html>
